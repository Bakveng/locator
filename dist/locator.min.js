angular.module("locator",[]).factory("location",["$log","$q",function(){"use strict";var e={isReady:!1,gpsAvailable:!0,detail:{}},o=[];return e.get=function(o,t){navigator.geolocation.getCurrentPosition(function(t){e.gpsAvailable=!0,e.current={latitude:t.coords.latitude,longitude:t.coords.longitude},console.log("CORDOVA","Latitude: "+t.coords.latitude+" , Longitude: "+t.coords.longitude),e.isReady=!0,e.onReadyTasks(),o()},function(o){e.gpsAvailable=!1,console.log("CORDOVA","code: "+o.code+"message: "+o.message),t()})},e.onReadyTasks=function(){for(var e=o.length-1;e>=0;e--)o[e]()},e.ready=function(t){e.isReady?t():o.push(t)},e}]),angular.module("locator").directive("locationLookup",["$log",function(){return{restrict:"E",require:"?ngModel",templateUrl:"location-lookup.html",link:function(e,o,t,n){e.limitTo=e.$eval(t.limitTo)||15,e.callback=e.$eval(t.callback);var r=document.createElement("div");r.setAttribute("id",e.ID);var l=new google.maps.places.PlacesService(o[0].appendChild(r));e.clear=function(){e.query=e.results=null},e.pickLocation=function(o){l.getDetails({reference:o.reference},function(t){e.$apply(function(){var r={name:o.terms[0].value,description:o.description,latitude:t.geometry.location.lat(),longitude:t.geometry.location.lng()};n.$setViewValue(r),e.clear(),e.callback&&e.callback(r)})})}}}}]),angular.module("locator").directive("locationPicker",["$log","location","reverseGeocoder",function(e,o,t){"use strict";return{restrict:"E",require:"?ngModel",templateUrl:"location-picker.html",link:function(n,r,l,a){o.ready(function(){t.geocode(o.current).then(function(e){n.options=e,console.log("####",e)},e.error)}),n.pickLocation=function(e){var e={latitude:o.current.latitude,longitude:o.current.longitude,name:e.address_components[0].short_name,description:e.formatted_address};a.$setViewValue(e)}}}}]),angular.module("locator").directive("locationPredictions",[function(){return{restrict:"A",scope:{ngModel:"=",results:"="},link:function(e){var o=new google.maps.places.AutocompleteService;e.fetch=function(){e.ngModel&&o.getPlacePredictions({input:e.ngModel},e.fetchCallback)},e.fetchCallback=function(o,t){return t!==google.maps.places.PlacesServiceStatus.OK?void(e.results=null):void(e.results=o)},e.$watch("ngModel",function(){e.fetch()})}}}]),angular.module("locator").factory("reverseGeocoder",["$document","$q",function(e,o){"use strict";var t={};return e.ready(function(){t.geocoder=new google.maps.Geocoder}),t.geocode=function(e){var n=o.defer();if(e)var r=new google.maps.LatLng(e.latitude,e.longitude);else n.reject("You need to provide LatLng");return t.geocoder.geocode({latLng:r},function(e,o){return o!==google.maps.GeocoderStatus.OK?void n.reject("No locations found"):void n.resolve(e)}),n.promise},t.geocodeAndFilter=function(e,n){var r=o.defer();if(e)var l=new google.maps.LatLng(e.latitude,e.longitude);else r.reject("You need to provide LatLng");return t.geocoder.geocode({latLng:l},function(e,o){if(o!==google.maps.GeocoderStatus.OK)return void r.reject("No locations found");var t;angular.forEach(e,function(e){e.types[0]!==n||t||(t=e)}),r.resolve(t)}),r.promise},t}]);